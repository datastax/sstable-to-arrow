#!/bin/bash

if [ "$#" -lt 2 ]; then
  echo "[SCRIPT] error: must pass path to folder with sstable files and path to CSV file to record results"
  exit 1
fi

echo "[SCRIPT] running cassandra"
for i in {1..10}; do
  echo "[SCRIPT] starting run $i"
  data=`/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/bin/java \
    -Dcassandra.config=file:///Users/alexcai/IdeaProjects/sstable-to-arrow/src/resources/cassandra.yaml \
    -javaagent:"/Applications/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=54044:/Applications/IntelliJ IDEA.app/Contents/bin" \
    -Dfile.encoding=UTF-8 \
    -classpath /Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/charsets.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/cldrdata.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/dnsns.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/dtfj.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/dtfjview.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/jaccess.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/localedata.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/nashorn.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/sunec.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/sunjce_provider.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/sunpkcs11.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/traceformat.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/ext/zipfs.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/jce.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/jsse.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/management-agent.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/resources.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/jre/lib/rt.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/lib/dt.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/lib/jconsole.jar:/Users/alexcai/Library/Java/JavaVirtualMachines/adopt-openj9-1.8.0_292/Contents/Home/lib/tools.jar:/Users/alexcai/IdeaProjects/sstable-to-arrow/target/classes:/Users/alexcai/.m2/repository/com/diffplug/durian/durian/3.4.0/durian-3.4.0.jar:/Users/alexcai/.m2/repository/org/apache/arrow/arrow-memory-netty/4.0.1/arrow-memory-netty-4.0.1.jar:/Users/alexcai/.m2/repository/org/apache/arrow/arrow-memory-core/4.0.1/arrow-memory-core-4.0.1.jar:/Users/alexcai/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar:/Users/alexcai/.m2/repository/io/netty/netty-buffer/4.1.48.Final/netty-buffer-4.1.48.Final.jar:/Users/alexcai/.m2/repository/io/netty/netty-common/4.1.48.Final/netty-common-4.1.48.Final.jar:/Users/alexcai/.m2/repository/org/apache/arrow/arrow-vector/4.0.1/arrow-vector-4.0.1.jar:/Users/alexcai/.m2/repository/org/apache/arrow/arrow-format/4.0.1/arrow-format-4.0.1.jar:/Users/alexcai/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.11.4/jackson-core-2.11.4.jar:/Users/alexcai/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.11.4/jackson-databind-2.11.4.jar:/Users/alexcai/.m2/repository/commons-codec/commons-codec/1.10/commons-codec-1.10.jar:/Users/alexcai/.m2/repository/com/google/flatbuffers/flatbuffers-java/1.12.0/flatbuffers-java-1.12.0.jar:/Users/alexcai/.m2/repository/org/apache/cassandra/cassandra-all/3.11.10/cassandra-all-3.11.10.jar:/Users/alexcai/.m2/repository/org/xerial/snappy/snappy-java/1.1.1.7/snappy-java-1.1.1.7.jar:/Users/alexcai/.m2/repository/net/jpountz/lz4/lz4/1.3.0/lz4-1.3.0.jar:/Users/alexcai/.m2/repository/com/ning/compress-lzf/0.8.4/compress-lzf-0.8.4.jar:/Users/alexcai/.m2/repository/commons-cli/commons-cli/1.1/commons-cli-1.1.jar:/Users/alexcai/.m2/repository/org/apache/commons/commons-lang3/3.1/commons-lang3-3.1.jar:/Users/alexcai/.m2/repository/org/apache/commons/commons-math3/3.2/commons-math3-3.2.jar:/Users/alexcai/.m2/repository/com/googlecode/concurrentlinkedhashmap/concurrentlinkedhashmap-lru/1.4/concurrentlinkedhashmap-lru-1.4.jar:/Users/alexcai/.m2/repository/org/antlr/antlr/3.5.2/antlr-3.5.2.jar:/Users/alexcai/.m2/repository/org/antlr/ST4/4.0.8/ST4-4.0.8.jar:/Users/alexcai/.m2/repository/org/antlr/antlr-runtime/3.5.2/antlr-runtime-3.5.2.jar:/Users/alexcai/.m2/repository/org/slf4j/log4j-over-slf4j/1.7.7/log4j-over-slf4j-1.7.7.jar:/Users/alexcai/.m2/repository/org/slf4j/jcl-over-slf4j/1.7.7/jcl-over-slf4j-1.7.7.jar:/Users/alexcai/.m2/repository/com/boundary/high-scale-lib/1.0.6/high-scale-lib-1.0.6.jar:/Users/alexcai/.m2/repository/org/yaml/snakeyaml/1.11/snakeyaml-1.11.jar:/Users/alexcai/.m2/repository/org/mindrot/jbcrypt/0.3m/jbcrypt-0.3m.jar:/Users/alexcai/.m2/repository/io/airlift/airline/0.6/airline-0.6.jar:/Users/alexcai/.m2/repository/io/dropwizard/metrics/metrics-core/3.1.5/metrics-core-3.1.5.jar:/Users/alexcai/.m2/repository/io/dropwizard/metrics/metrics-jvm/3.1.5/metrics-jvm-3.1.5.jar:/Users/alexcai/.m2/repository/com/addthis/metrics/reporter-config3/3.0.3/reporter-config3-3.0.3.jar:/Users/alexcai/.m2/repository/com/addthis/metrics/reporter-config-base/3.0.3/reporter-config-base-3.0.3.jar:/Users/alexcai/.m2/repository/org/hibernate/hibernate-validator/4.3.0.Final/hibernate-validator-4.3.0.Final.jar:/Users/alexcai/.m2/repository/javax/validation/validation-api/1.0.0.GA/validation-api-1.0.0.GA.jar:/Users/alexcai/.m2/repository/org/jboss/logging/jboss-logging/3.1.0.CR2/jboss-logging-3.1.0.CR2.jar:/Users/alexcai/.m2/repository/com/thinkaurelius/thrift/thrift-server/0.3.7/thrift-server-0.3.7.jar:/Users/alexcai/.m2/repository/com/lmax/disruptor/3.0.1/disruptor-3.0.1.jar:/Users/alexcai/.m2/repository/ch/qos/logback/logback-core/1.1.3/logback-core-1.1.3.jar:/Users/alexcai/.m2/repository/ch/qos/logback/logback-classic/1.1.3/logback-classic-1.1.3.jar:/Users/alexcai/.m2/repository/org/apache/thrift/libthrift/0.9.2/libthrift-0.9.2.jar:/Users/alexcai/.m2/repository/org/apache/httpcomponents/httpclient/4.2.5/httpclient-4.2.5.jar:/Users/alexcai/.m2/repository/org/apache/httpcomponents/httpcore/4.2.4/httpcore-4.2.4.jar:/Users/alexcai/.m2/repository/org/apache/cassandra/cassandra-thrift/3.11.10/cassandra-thrift-3.11.10.jar:/Users/alexcai/.m2/repository/com/carrotsearch/hppc/0.5.4/hppc-0.5.4.jar:/Users/alexcai/.m2/repository/de/jflex/jflex/1.6.0/jflex-1.6.0.jar:/Users/alexcai/.m2/repository/org/apache/ant/ant/1.7.0/ant-1.7.0.jar:/Users/alexcai/.m2/repository/org/apache/ant/ant-launcher/1.7.0/ant-launcher-1.7.0.jar:/Users/alexcai/.m2/repository/com/github/rholder/snowball-stemmer/1.3.0.581.1/snowball-stemmer-1.3.0.581.1.jar:/Users/alexcai/.m2/repository/com/googlecode/concurrent-trees/concurrent-trees/2.4.0/concurrent-trees-2.4.0.jar:/Users/alexcai/.m2/repository/io/netty/netty-all/4.0.44.Final/netty-all-4.0.44.Final.jar:/Users/alexcai/.m2/repository/joda-time/joda-time/2.4/joda-time-2.4.jar:/Users/alexcai/.m2/repository/org/fusesource/sigar/1.6.4/sigar-1.6.4.jar:/Users/alexcai/.m2/repository/org/eclipse/jdt/core/compiler/ecj/4.4.2/ecj-4.4.2.jar:/Users/alexcai/.m2/repository/org/caffinitas/ohc/ohc-core/0.4.4/ohc-core-0.4.4.jar:/Users/alexcai/.m2/repository/org/caffinitas/ohc/ohc-core-j8/0.4.4/ohc-core-j8-0.4.4.jar:/Users/alexcai/.m2/repository/com/github/ben-manes/caffeine/caffeine/2.2.6/caffeine-2.2.6.jar:/Users/alexcai/.m2/repository/org/apache/cassandra/cassandra-clientutil/3.9/cassandra-clientutil-3.9.jar:/Users/alexcai/.m2/repository/org/apache/cassandra/cassandra-javautils/0.7.1/cassandra-javautils-0.7.1.jar:/Users/alexcai/.m2/repository/org/jctools/jctools-core/2.1.2/jctools-core-2.1.2.jar:/Users/alexcai/.m2/repository/org/agrona/agrona/1.0.2/agrona-1.0.2.jar:/Users/alexcai/.m2/repository/com/github/jbellis/jamm/0.3.3/jamm-0.3.3.jar:/Users/alexcai/.m2/repository/org/msgpack/jackson-dataformat-msgpack/0.8.16/jackson-dataformat-msgpack-0.8.16.jar:/Users/alexcai/.m2/repository/org/msgpack/msgpack-core/0.8.16/msgpack-core-0.8.16.jar:/Users/alexcai/.m2/repository/io/reactivex/rxjava/1.3.6/rxjava-1.3.6.jar:/Users/alexcai/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.11.4/jackson-annotations-2.11.4.jar:/Users/alexcai/.m2/repository/io/reactivex/rxjava2/rxjava/2.2.7/rxjava-2.2.7.jar:/Users/alexcai/.m2/repository/org/reactivestreams/reactive-streams/1.0.2/reactive-streams-1.0.2.jar:/Users/alexcai/.m2/repository/com/google/inject/guice/4.0/guice-4.0.jar:/Users/alexcai/.m2/repository/javax/inject/javax.inject/1/javax.inject-1.jar:/Users/alexcai/.m2/repository/aopalliance/aopalliance/1.0/aopalliance-1.0.jar:/Users/alexcai/.m2/repository/com/google/inject/extensions/guice-assistedinject/4.0/guice-assistedinject-4.0.jar:/Users/alexcai/.m2/repository/com/google/inject/extensions/guice-multibindings/4.0/guice-multibindings-4.0.jar:/Users/alexcai/.m2/repository/com/clearspring/analytics/stream/2.7.0/stream-2.7.0.jar:/Users/alexcai/.m2/repository/it/unimi/dsi/fastutil/6.5.7/fastutil-6.5.7.jar:/Users/alexcai/.m2/repository/org/ow2/asm/asm/7.0/asm-7.0.jar:/Users/alexcai/.m2/repository/com/google/guava/guava/19.0/guava-19.0.jar:/Users/alexcai/.m2/repository/io/netty/netty-transport-native-epoll/4.1.25.5.dse/netty-transport-native-epoll-4.1.25.5.dse.jar:/Users/alexcai/.m2/repository/io/netty/netty-transport-native-unix-common/4.1.25.5.dse/netty-transport-native-unix-common-4.1.25.5.dse.jar:/Users/alexcai/.m2/repository/io/netty/netty-transport/4.1.25.5.dse/netty-transport-4.1.25.5.dse.jar:/Users/alexcai/.m2/repository/io/netty/netty-resolver/4.1.25.5.dse/netty-resolver-4.1.25.5.dse.jar:/Users/alexcai/.m2/repository/net/java/dev/jna/jna/5.0.0/jna-5.0.0.jar:/Users/alexcai/.m2/repository/com/googlecode/json-simple/json-simple/1.1/json-simple-1.1.jar:/Users/alexcai/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar:/Users/alexcai/.m2/repository/org/apache/directory/api/api-ldap-model/1.0.0.2.dse/api-ldap-model-1.0.0.2.dse.jar:/Users/alexcai/.m2/repository/org/apache/directory/api/api-util/1.0.0.2.dse/api-util-1.0.0.2.dse.jar:/Users/alexcai/.m2/repository/org/apache/directory/api/api-asn1-api/1.0.0.2.dse/api-asn1-api-1.0.0.2.dse.jar:/Users/alexcai/.m2/repository/org/apache/directory/api/api-asn1-ber/1.0.0.2.dse/api-asn1-ber-1.0.0.2.dse.jar:/Users/alexcai/.m2/repository/org/apache/directory/api/api-i18n/1.0.0.2.dse/api-i18n-1.0.0.2.dse.jar:/Users/alexcai/.m2/repository/org/apache/mina/mina-core/2.0.16/mina-core-2.0.16.jar:/Users/alexcai/.m2/repository/org/apache/servicemix/bundles/org.apache.servicemix.bundles.antlr/2.7.7_5/org.apache.servicemix.bundles.antlr-2.7.7_5.jar:/Users/alexcai/.m2/repository/commons-lang/commons-lang/2.6/commons-lang-2.6.jar:/Users/alexcai/.m2/repository/commons-collections/commons-collections/3.2.2/commons-collections-3.2.2.jar:/Users/alexcai/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/Users/alexcai/.m2/repository/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar:/Users/alexcai/.m2/repository/org/testng/testng/7.4.0/testng-7.4.0.jar:/Users/alexcai/.m2/repository/com/beust/jcommander/1.78/jcommander-1.78.jar:/Users/alexcai/.m2/repository/org/webjars/jquery/3.5.1/jquery-3.5.1.jar:/Users/alexcai/.m2/repository/com/carrotsearch/randomizedtesting/randomizedtesting-runner/2.1.2/randomizedtesting-runner-2.1.2.jar:/Users/alexcai/.m2/repository/com/datastax/dse/dse-java-driver-core/1.10.0-dse+20210424/dse-java-driver-core-1.10.0-dse+20210424.jar:/Users/alexcai/.m2/repository/io/netty/netty-handler/4.0.56.Final/netty-handler-4.0.56.Final.jar:/Users/alexcai/.m2/repository/io/netty/netty-codec/4.0.56.Final/netty-codec-4.0.56.Final.jar:/Users/alexcai/.m2/repository/com/github/jnr/jnr-ffi/2.1.7/jnr-ffi-2.1.7.jar:/Users/alexcai/.m2/repository/com/github/jnr/jffi/1.2.16/jffi-1.2.16.jar:/Users/alexcai/.m2/repository/com/github/jnr/jffi/1.2.16/jffi-1.2.16-native.jar:/Users/alexcai/.m2/repository/org/ow2/asm/asm-commons/5.0.3/asm-commons-5.0.3.jar:/Users/alexcai/.m2/repository/org/ow2/asm/asm-analysis/5.0.3/asm-analysis-5.0.3.jar:/Users/alexcai/.m2/repository/org/ow2/asm/asm-tree/5.0.3/asm-tree-5.0.3.jar:/Users/alexcai/.m2/repository/org/ow2/asm/asm-util/5.0.3/asm-util-5.0.3.jar:/Users/alexcai/.m2/repository/com/github/jnr/jnr-x86asm/1.0.2/jnr-x86asm-1.0.2.jar:/Users/alexcai/.m2/repository/com/github/jnr/jnr-posix/3.0.44/jnr-posix-3.0.44.jar:/Users/alexcai/.m2/repository/com/github/jnr/jnr-constants/0.9.9/jnr-constants-0.9.9.jar:/Users/alexcai/.m2/repository/com/esri/geometry/esri-geometry-api/1.2.1/esri-geometry-api-1.2.1.jar:/Users/alexcai/.m2/repository/org/json/json/20090211/json-20090211.jar:/Users/alexcai/.m2/repository/org/codehaus/jackson/jackson-core-asl/1.9.12/jackson-core-asl-1.9.12.jar \
    SSTableLoaderTest "$1"`

  echo "[SCRIPT] grepped data:"
  echo "$data" | grep "\[PROFILE\]" | while read line1; do
    read line2
    read line3
    echo "$i,${line1:35},${line2:26},${line3:20}" >> "$2"
  done
done

